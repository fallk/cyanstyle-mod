<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  <% 
  function stripTags(str) {
    return str.

    replace(/<br>/g, '\n'). // replace newlines
    replace(/<br\/>/g, '\n'). // replace newlines
    replace(/<br \/>/g, '\n'). // replace newlines
    replace(/<\/br>/g, ''). // not \n

    replace(/<img src="(.*?)".*?(>.*?<\/img>|\/>)/gi, '$1'). // replace image links

    replace(/<(?:.|\n)*?>/gm, ''). // strip html tags

    //.replace(/\[link\] \[comments\]/g, '') // reddit [link] and [comments] at the end of post

    replace(/&#32;/g, ' '). // space bug

    replace(/  +/g, ' '). // dupe spaces
    trim(). // remove leading and trailing whitespace

    replace(/\[link\] \[comments\]/g, '') // reddit [link] and [comments] at the end of post

    ;
  }

  page._description = stripTags(page.content);
  %>

  <meta name="description" content="<%= page._description %>" />

  <% if (page.keywords){ %>
  <meta name="keywords" content="<%= page.keywords %>" />
  <% } else if(config.keywords) { %>
  <meta name="keywords" content="<%= config.keywords %>" />
  <% } %>
  
  <% if (theme.google_site_verification){ %><meta name="google-site-verification" content="<%= theme.google_site_verification%>" /><% } %>
  <% if (theme.baidu_site_verification){ %><meta name="baidu-site-verification" content="<%= theme.baidu_site_verification%>" /><% } %>
  
  <%
  var title = page.title;

  if (is_archive()){
    title = 'Archives';

    if (is_month()){
      title += ': ' + page.year + '/' + page.month;
    } else if (is_year()){
      title += ': ' + page.year;
    }
  } else if (is_category()){
    title = 'Category: ' + page.category;
  } else if (is_tag()){
    title = 'Tag: ' + page.tag;
  }
  %>
  <title>
    <% if (page.altTitle) { %>
      <%= config.title %>
    <% 
    } else {
      if (title) { %>
        <%= title %> | 
      <% } %>
      <%= config.title %>
    <% } %></title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <%- open_graph({twitter_id: theme.twitter, google_plus: theme.google_plus, fb_admins: theme.fb_admins, fb_app_id: theme.fb_app_id}) %>
  <% if (theme.rss){ %>
    <link rel="alternative" href="<%- theme.rss %>" title="<%= config.title %>" type="application/atom+xml">
  <% } %>
  <% if (theme.favicon){ %>
    <link rel="icon" href="<%- theme.favicon %>">
  <% } else { %>
    <link rel="icon" href="<%- config.root %>css/images/favicon.ico">
  <% } %>
  <link href="https://fonts.googleapis.com/css?family=Roboto|Source+Code+Pro" rel="stylesheet">
  <% if (page.useGithubLayout) { %>
    <%- css('css/github-markdown.css') %>
    <%- css('css/github-style.css') %>
    <script type="text/javascript" src="https://code.jquery.com/jquery-latest.min.js"></script>
    <%- css('css/spoilers.css') %>
    <%- partial('spoiler-js') %>
  <% } else { %>
    <%- css('css/style') %>
  <% } %>
  <%- partial('google-analytics') %>
  
  <!-- baidu webmaster push -->
  <!-- tracking
  <script src='//push.zhanzhang.baidu.com/push.js'></script>
  -->

</head>